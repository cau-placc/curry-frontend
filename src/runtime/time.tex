\nwfilename{time.nw}\nwbegindocs{0}% -*- noweb-code-mode: c-mode -*-% ===> this file was generated automatically by noweave --- better not edit it
% $Id: time.nw,v 2.1 2003/09/02 15:16:43 wlux Exp $
%
% Copyright (c) 2003, Wolfgang Lux
% See ../LICENSE for the full license.
%
\subsection{Time}
At present, the {\Tt{}Time\nwendquote} library module only implements a function to
return the current time. This will be extended in future releases.

\nwenddocs{}\nwbegincode{1}\sublabel{NW3flK6P-HWcBW-1}\nwmargintag{{\nwtagstyle{}\subpageref{NW3flK6P-HWcBW-1}}}\moddef{time.c~{\nwtagstyle{}\subpageref{NW3flK6P-HWcBW-1}}}\endmoddef\nwstartdeflinemarkup\nwprevnextdefs{\relax}{NW3flK6P-HWcBW-2}\nwenddeflinemarkup
#include "config.h"
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <errno.h>
#include <unistd.h>
#include <time.h>
#include "debug.h"
#include "run.h"
#include "heap.h"
#include "stack.h"
#include "threads.h"
#include "eval.h"
#include "cstring.h"
#include "io_monad.h"
#include "cam.h"
#include "trace.h"

\nwalsodefined{\\{NW3flK6P-HWcBW-2}}\nwnotused{time.c}\nwendcode{}\nwbegindocs{2}\nwdocspar
The computation {\Tt{}getClockTime\nwendquote} returns the current time as an
integer. Note that the {\Tt{}Time\nwendquote} module defines {\Tt{}ClockTime\nwendquote} as an
abstract type.

\nwenddocs{}\nwbegincode{3}\sublabel{NW3flK6P-HWcBW-2}\nwmargintag{{\nwtagstyle{}\subpageref{NW3flK6P-HWcBW-2}}}\moddef{time.c~{\nwtagstyle{}\subpageref{NW3flK6P-HWcBW-1}}}\plusendmoddef\nwstartdeflinemarkup\nwprevnextdefs{NW3flK6P-HWcBW-1}{\relax}\nwenddeflinemarkup
DECLARE_ENTRYPOINT(__getClockTime);

FUNCTION(__getClockTime)
\{
    time_t tim;
    Node   *r;
    EXPORT_LABEL(__getClockTime)
 ENTRY_LABEL(__getClockTime)

    if ( time(&tim) == (time_t)-1 )
    \{
        CHECK_STACK1();
        r     = from_string(strerror(errno));
        *--sp = r;
        GOTO(__ioError);
    \}

    sp += 1;
#if ONLY_BOXED_OBJECTS
    CHECK_HEAP(int_node_size);
    r       = (Node *)hp;
    r->info = &int_info;
    r->i.i  = tim;
    hp     += int_node_size;
#else
    r = mk_int(tim);
#endif
    RETURN(r);
\}
\nwendcode{}

\nwixlogsorted{c}{{time.c}{NW3flK6P-HWcBW-1}{\nwixd{NW3flK6P-HWcBW-1}\nwixd{NW3flK6P-HWcBW-2}}}%

